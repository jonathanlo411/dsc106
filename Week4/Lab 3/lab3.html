<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
    <script>        
        //Task 1: Define your rowConverter function
        let rowConverter = function(d){
            return {
                name : d.Name,   
                manufacturer : d.Manufacturer,        
                calories : +d.Calories, 
                carbo : +d.Carbo,
                year : +d.Year
            }
        }

        d3.csv("cereal.csv", rowConverter).then((data) => {
            console.log(data);
        
            //Task 2: Group the cereals by manufacturers, and output it to the console
            let manufacturers = d3.group(data, d => d.manufacturer)
            console.log(manufacturers)

            //Task 3: Get the sum of carbo, per manufacturer, and output it to the console
            let sums = d3.rollup(data, v => d3.sum(v, d => d.carbo ), d => d.manufacturer)
            console.log(sums)

            //Task 4: Find the sum of calories for manufacturer "K" in 2020, and output it to the console
            let sumK = d3.sum(data.filter((d, i) => d.manufacturer === 'K' && d.year === 2020), d => d.calories)
            console.log(sumK)

            const width = 400;
            const height = 300;
            const svg = d3
                .select("body")
                .append("svg")
                .attr("width", width)
                .attr("height", height);

            //Task 5: Create a bar chart of the sum of carbo, per manufacturer
            let t = [...sums.keys()]
            let maxVal = 0
            let length = 0
            for (let i in t) {
                const key = t[i]
                const val = sums.get(key)
                if (val > maxVal) { maxVal = val } 
                length = +i + 1 
            }

            const xScale = width / maxVal
            const yScale = height / length
            svg.selectAll('.bar')
                .data(sums).enter()
                    .append("rect")
                .attr("class", "bar")
                .attr("width", d => d[1] * xScale)
                .attr("height", yScale - 2)
                .attr("x", 0)
                .attr("y", (d, i) => i * yScale)
                .attr("fill", "#69b3a2")


        });
    </script>
</body>
</html>