<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<script src="https://d3js.org/d3.v7.min.js"></script>
	<title>Lab 4 Material</title>
</head>

<body>
	<div id="Lab4">
		<p>Activity Generate a barplot and Add dynamic scaling</p>
	</div>


	<script type="text/javascript">

		// Load cereal.csv to a const variable cereals
		let rowConverter = function (d) {
			return {
				Name: d.Name,
				Manufacturer: d.Manufacturer,
				Calories: parseFloat(d.Calories),
				Carbo: parseFloat(d.Carbo),
				Year: +d.Year
			};
		}

		const cereals = d3.csv("cereal.csv", rowConverter);


		cereals.then(function (data) {

            const margin = {top: 30, right: 30, bottom: 70, left: 60},
                width = 460 - margin.left - margin.right,
                height = 400 - margin.top - margin.bottom;
			            
            var svg = d3.select("#Lab4").append("svg")
                        .attr("width", width + margin.left + margin.right)
                        .attr("height", height + margin.top + margin.bottom)
                        .append("g")
                        .attr("transform",
                            "translate(" + margin.left + "," + margin.top + ")");
                
			
            // calculate the number of cereals for each manufacturer
            const cerealCounts = d3.rollup(data, v => v.length, d => d.Manufacturer)

            // drawing the barplot, without dynamic scaling for now (slide 1)
            // svg.selectAll(".bar")
            //     .data(cerealCounts).enter()
            //         .append("rect")
            //     .attr("class", "bar")
            //     .attr("x", (d, i) => i * 5)
            //     .attr("y", d => height - d[1])
            //     .attr("height", d => d[1])
            //     .attr("width", d => 3)
            //     .attr("fill", "blue")

            // we will integrate dynamic scaling in slide 2
            const dataArray = Array.from(cerealCounts, ([key, value]) => ({ key, value }));
            let xScale = d3.scaleBand()
                .domain(dataArray.map(d => d.key))
                .range([0, width])
                .padding(0.1)
            let yScale = d3.scaleLinear()
                .domain([0, d3.max(dataArray.map(d => d.value))])
                .range([height, 0])
            
            svg.selectAll(".bar")
                .data(dataArray).enter().append("rect")
                .attr("class", "bar")
                .attr("x", d => xScale(d.key))
                .attr("y", d => yScale(d.value))
                .attr("width", xScale.bandwidth())
                .attr("height", d => height - yScale(d.value))
                .attr("fill", "blue")
                .style("opacity", "0.5");
			
            // Add the x and y axes (slide 3)
            svg.append("g").call(d3.axisBottom(xScale))
                .attr("class", "xAxis")
                .attr("transform", `translate(0, ${height})`)
            svg.append("g").call(d3.axisLeft(yScale))
                .attr("class", "yAxis")

			// Add the labels for each bar (slide 4)
            svg.selectAll(".bar-labels")
                .data(dataArray).enter().append("text")
                .attr("x", d => xScale(d.key))
                .attr("y", d => yScale(d.value))
                .attr("text-anchor", "right")
                .text(d => d.value)


		});

	</script>

</body>

</html>